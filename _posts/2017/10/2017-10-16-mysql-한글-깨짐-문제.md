---
layout: post
title: MySQL 한글 깨짐 문제
description: ''
date: '2017-10-15 16:25'
categories:
  - Database
tags:
  - Database
  - MySQL
---

## 문제
JPA를 이용해 INSERT시 DB에서 한글이 **???**로 깨져서 등록이 됨. <br/>
___에러가 발생한 환경은 Spring boot JPA + MySQL(ubuntu of EC2)___


## 해결
Datasource URL에 인코딩 속성 적용
> jdbc:mysql://URL?useSSL=false**&useUnicode=true&characterEncoding=utf8**


그러나, INSERT시 다음과 같은 오류가 발생
>  java.sql.SQLException: Incorrect string value: '\xEC\x84\x9C\xEC\x9A\xB8...' for column 'address' at row 1

MySQL의 config 파일(my.cnf)에 인코딩 속성을 적용해줘야한다고 함. <br/>
MySQL을 명시적으로 설정하지 않으면 기본 캐릭터셋 -> **latin1** <br/>


> 1. whereis mysql (MySQL의 config 파일 위치 찾기) <br/><br/>
> 2. cd /etc/mysql (my.cnf파일이 있는 폴더로 이동) <br/><br/>
> 3. sudo vi my.cnf (에디터를 열어 아래와 같이 입력한 후, 저장) <br/>
  아래의 내용은 **MySQL 5.5 이상**일 때이다. <br/>
> [mysqld] <br/>
> init_connect='SET collation_connection = utf8_unicode_ci' <br/>
> init_connect='SET NAMES utf8' <br/>
>  character-set-server=utf8 <br/>
> collation-server=utf8_unicode_ci <br/>
> skip-character-set-client-handshake <br/>

> 4. (sudo) service mysql(mysqld) restart

캐릭터셋을 확인하는 방법은 MySQL CLI에서 다음과 같은 명령어를 입력. <br/>

> mysql> status; <br/>
> ㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡ <br/>
> Server characterset:	utf8 <br/>
> Db     characterset:	utf8 <br/>
> Client characterset:	utf8 <br/>
> Conn.  characterset:	utf8 <br/>
> ㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡㅡ <br/>

또는,
``` SQL
SHOW VARIABLES LIKE 'char%';
SHOW VARIABLES LIKE 'collation%';
```
테이블이 이미 생성되어있는 경우에는 캐릭터셋이 그대로이기 때문에 변경해주어야한다. <br/>

생성된 테이블의 정보 확인
``` mysql
SHOW CREATE TABLE table_name;
```
테이블의 캐릭터셋 변경
``` mysql
ALTER TABLE table_name CONVERT TO character SET utf8;
```
잘바뀌어졌는지 확인한다. <br/>


--------------------------------
<br/>

### 참고문서
* [MySQL 기본 캐릭터 셋 설정하기](https://www.lesstif.com/pages/viewpage.action?pageId=20775198)
* [Stackoverflow - “Incorrect string value” when trying to insert UTF-8 into MySQL via JDBC?](https://stackoverflow.com/questions/10957238/incorrect-string-value-when-trying-to-insert-utf-8-into-mysql-via-jdbc)
